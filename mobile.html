<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Snake Boss Survival â€” Mobile</title>
<meta name="theme-color" content="#0b0f1d">
<style>
  :root{ --bg1:#0b0f1d; --bg2:#0e1730; --border:rgba(255,255,255,.12); --glass:rgba(17,25,48,.55);
         --food:#ff5470; --snake:#47d16e; --head:#caffdd; --boss:#7aa2f7; --bossHead:#d7e7ff; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; color:#e8f0ff; font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,var(--bg1),var(--bg2)); display:grid; grid-template-rows:auto 1fr auto; padding:10px}
  header,footer{width:min(700px,100%); margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:8px}
  .pill{padding:8px 12px; background:var(--glass); border:1px solid var(--border); border-radius:12px; backdrop-filter:blur(8px); font-size:14px}
  .frame{width:min(700px,100%); margin:0 auto}
  .stage{position:relative}
  canvas{width:100%; height:auto; aspect-ratio:9/16; background:#0a0f1a; border:1px solid var(--border); border-radius:20px; image-rendering:pixelated; touch-action:none}
  .hud{position:absolute; top:8px; left:50%; transform:translateX(-50%); text-align:center; pointer-events:none}
  .score{font:900 clamp(28px,8vw,48px)/1 Inter,system-ui; color:var(--head); text-shadow:0 6px 18px rgba(71,209,110,.45)}
  .best{margin-top:4px; font:12px/1 Inter,system-ui; color:#b8c7e6; background:var(--glass); border:1px solid var(--border); padding:6px 10px; border-radius:12px}
  #chip{position:absolute; right:10px; top:10px; background:var(--glass); border:1px solid var(--border); padding:6px 10px; border-radius:12px; font-size:12px}
</style>
</head>
<body>
<header>
  <div style="font-weight:800">Snake Boss Survival â€” Mobile</div>
  <div>
    <a class="pill" href="index.html">ðŸ’» Byt till desktop</a>
  </div>
</header>

<div class="frame">
  <div class="stage">
    <canvas id="cv" width="540" height="960"></canvas>
    <div class="hud">
      <div id="score" class="score">0</div>
      <div class="best">ðŸ‘‘ Rekord: <span id="best">0</span></div>
    </div>
    <div id="chip">ðŸ‘‰ HÃ¥ll & dra pÃ¥ spelplanen</div>
  </div>
</div>

<audio id="bgm" src="soundtrack.mp3" preload="auto" loop></audio>

<footer>
  <div>Made by <strong>Niclas Vestlund</strong></div>
  <div><a href="https://www.youtube.com/@niclasvestlundYT" target="_blank">YouTube</a></div>
</footer>

<script>
(()=>{
const cv=document.getElementById('cv'), ctx=cv.getContext('2d');
const ui={score:byId('score'), best:byId('best'), chip:byId('chip'), bgm:byId('bgm')};
function byId(id){return document.getElementById(id)}
let cols=20, rows=28, cell=20, padX=0,padY=0; // vertikal grid

function resize(){
  const rect=cv.getBoundingClientRect();
  const dpr=Math.min(2, devicePixelRatio||1);
  cv.width=Math.floor(rect.width*dpr); cv.height=Math.floor(rect.height*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  cell=Math.floor(Math.min(rect.width/cols, rect.height/rows));
  padX=Math.floor((rect.width-cols*cell)/2); padY=Math.floor((rect.height-rows*cell)/2);
}
addEventListener('resize', resize); setTimeout(resize);

let running=false, loop=null, tickMs=120;
let snake, dir='right', nextDir='right', food, score=0, best=parseInt(localStorage.getItem('sbs_best_mob')||'0');
let boss, bossAlt=false, shieldTicks=10, lastGlow='default', bossEasy=40;

function reset(){
  const sy=(rows/2)|0;
  snake=[{x:(cols/2)|0-4,y:sy},{x:(cols/2)|0-5,y:sy},{x:(cols/2)|0-6,y:sy}];
  dir='right'; nextDir='right';
  const by=Math.max(2, sy-6);
  boss=[{x:cols-5,y:by},{x:cols-6,y:by},{x:cols-7,y:by}];
  food=safeFood(); score=0; ui.score.textContent=0; ui.best.textContent=best;
  bossEasy=40; shieldTicks=10; lastGlow='default';
}
function safeFood(){ let c; do{ c={x:(Math.random()*cols)|0,y:(Math.random()*rows)|0}; }while(onSnakeOrBoss(c)||dist(c,snake[0])<8||dist(c,boss[0])<8); return c; }
function onSnakeOrBoss(p){ return snake.some(s=>s.x===p.x&&s.y===p.y)||boss.some(b=>b.x===p.x&&b.y===p.y); }
function dist(a,b){ return Math.abs(a.x-b.x)+Math.abs(a.y-b.y); }
function wrap(v,m){ return (v+m)%m; }

// Start on first touch anywhere on canvas
let swStartX=0, swStartY=0, swActive=false; const DEAD=22, SNAP=90; let lastSnap=0;
cv.addEventListener('touchstart',(e)=>{ 
  const t=e.touches[0]; swStartX=t.clientX; swStartY=t.clientY; swActive=true; e.preventDefault();
  if(!running) { running=true; try{ ui.bgm.volume=.3; ui.bgm.play().catch(()=>{});}catch(e){}; loop=setInterval(()=>{ tick(); draw(); }, tickMs); ui.chip.style.opacity=.3; }
},{passive:false});
cv.addEventListener('touchmove',(e)=>{
  if(!swActive) return; const t=e.touches[0]; const dx=t.clientX-swStartX, dy=t.clientY-swStartY;
  if(Math.hypot(dx,dy)<DEAD) return; const now=performance.now(); if(now-lastSnap<SNAP) return;
  if(Math.abs(dx)>Math.abs(dy)) setDir(dx>0?'right':'left'); else setDir(dy>0?'down':'up'); lastSnap=now; e.preventDefault();
},{passive:false});
cv.addEventListener('touchend',()=>{ swActive=false; },{passive:true});

function setDir(d){ const m={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}; const [dx,dy]=m[d],[cx,cy]=m[dir]; if(dx===-cx&&dy===-cy)return; nextDir=d; }

function tick(){
  const m={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]}, [dx,dy]=m[nextDir];
  const head={x:wrap(snake[0].x+dx,cols), y:wrap(snake[0].y+dy,rows)};
  if(shieldTicks<=0){
    if(snake.some((s,i)=>i&&s.x===head.x&&s.y===head.y)) return gameOver();
    if(boss.some(b=>b.x===head.x&&b.y===head.y)) return gameOver();
  } else shieldTicks--;
  snake.unshift(head); dir=nextDir;

  if(head.x===food.x&&head.y===food.y){
    score++; ui.score.textContent=score;
    if(score>best){ best=score; localStorage.setItem('sbs_best_mob',best); ui.best.textContent=best; }
    if(score>=15) lastGlow='gold'; else if(score>=10) lastGlow='purple'; else if(score>=5) lastGlow='blue';
    food=safeFood();
  } else snake.pop();

  let mult=bossEasy>0?0.5:1; bossEasy=Math.max(0,bossEasy-1);
  const steps=((bossAlt?2:1)*mult|0)||1*mult|0; bossAlt=!bossAlt;
  for(let i=0;i<steps;i++){ bossStep(); if(boss[0].x===food.x&&boss[0].y===food.y){ food=safeFood(); break; } }
}
function bossStep(){
  const h=boss[0], opts=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}];
  opts.sort((a,b)=>(Math.abs((h.x+a.x)-food.x)+Math.abs((h.y+a.y)-food.y))-(Math.abs((h.x+b.x)-food.x)+Math.abs((h.y+b.y)-food.y)));
  const n={x:wrap(h.x+opts[0].x,cols), y:wrap(h.y+opts[0].y,rows)}; boss.unshift(n); boss.pop();
}
function gameOver(){
  clearInterval(loop); running=false;
  // Quick restart: wait a beat then reset and show chip hint again
  setTimeout(()=>{ reset(); draw(); ui.chip.style.opacity=1; }, 300);
}

function draw(){
  const w=cv.getBoundingClientRect().width, h=cv.getBoundingClientRect().height;
  ctx.clearRect(0,0,w,h);
  // grid
  for(let y=0;y<rows;y++){ for(let x=0;x<cols;x++){ ctx.globalAlpha=((x+y)%2===0)?0.06:0.04; ctx.fillStyle='#7aa2f7'; ctx.fillRect(padX+x*cell,padY+y*cell,cell,cell);} } ctx.globalAlpha=1;
  // food
  const t=Date.now()*0.004, bob=Math.sin(t*2)*2, fx=padX+food.x*cell+4, fy=padY+food.y*cell+4+bob, pulse=(Math.sin(t*3)*0.5+0.5)*0.3+0.7;
  ctx.fillStyle='#ff5470'; ctx.globalAlpha=pulse; ctx.fillRect(fx,fy,cell-8,cell-8); ctx.globalAlpha=1;
  // snake
  let glow='#2cff96'; if(lastGlow==='blue') glow='rgba(125,211,252,0.8)'; if(lastGlow==='purple') glow='rgba(192,132,252,0.85)'; if(lastGlow==='gold') glow='rgba(255,209,102,0.9)';
  for(let i=snake.length-1;i>=0;i--){ const s=snake[i], head=i===0;
    if(head){ ctx.fillStyle=glow; ctx.globalAlpha=.25; ctx.fillRect(padX+s.x*cell,padY+s.y*cell,cell,cell); ctx.globalAlpha=1; ctx.fillStyle='#caffdd'; }
    else ctx.fillStyle='#47d16e';
    roundRect(padX+s.x*cell+1,padY+s.y*cell+1,cell-2,cell-2,6); ctx.fill();
  }
  // boss
  for(let i=boss.length-1;i>=0;i--){ const b=boss[i], head=i===0; ctx.fillStyle=head?'#d7e7ff':'#7aa2f7'; roundRect(padX+b.x*cell+2,padY+b.y*cell+2,cell-4,cell-4,6); ctx.fill(); }
}
function roundRect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
reset(); draw();
})();
</script>
</body>
</html>
