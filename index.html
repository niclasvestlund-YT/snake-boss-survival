
<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Snake Boss Survival - Mobilversion</title>
<style>
  body {
    margin: 0;
    background: #0b0e16;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  canvas {
    background: repeating-linear-gradient(
      0deg,
      #0d1019,
      #0d1019 20px,
      #10131c 20px,
      #10131c 40px
    );
    display: block;
  }
  #controls {
    display: none;
    margin-top: 10px;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .btn {
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    user-select: none;
    touch-action: manipulation;
  }
  #scoreboard {
    font-size: 1.2em;
    margin: 10px;
  }
</style>
</head>
<body>
<h1>Snake Boss Survival</h1>
<div id="scoreboard">Poäng: 0 | Rekord: 0</div>
<canvas id="game" width="400" height="400"></canvas>
<div id="controls">
  <div class="btn" data-dir="up">▲</div>
  <div style="display:flex; gap:10px;">
    <div class="btn" data-dir="left">◀</div>
    <div class="btn" data-dir="right">▶</div>
  </div>
  <div class="btn" data-dir="down">▼</div>
</div>
<audio id="bgm" src="soundtrack.mp3" loop></audio>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const size = 20;
let snake = [{x: 5, y: 5}];
let boss = [{x: 10, y: 10}];
let food = {x: 15, y: 15};
let dx = 1, dy = 0;
let bdx = 0, bdy = 1;
let score = 0, highScore = 0;
let gameInterval;
let running = false;

function spawnFood() {
  food = {x: Math.floor(Math.random()* (canvas.width/size)), y: Math.floor(Math.random()* (canvas.height/size))};
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "lime";
  snake.forEach(p => ctx.fillRect(p.x*size, p.y*size, size-2, size-2));
  ctx.fillStyle = "purple";
  boss.forEach(p => ctx.fillRect(p.x*size, p.y*size, size-2, size-2));
  ctx.fillStyle = "red";
  ctx.fillRect(food.x*size, food.y*size, size-2, size-2);
}

function move() {
  const head = {x: snake[0].x + dx, y: snake[0].y + dy};
  snake.unshift(head);
  if (head.x === food.x && head.y === food.y) {
    score++;
    spawnFood();
  } else {
    snake.pop();
  }
  if (head.x<0 || head.x>=canvas.width/size || head.y<0 || head.y>=canvas.height/size) reset();
  if (boss.some(p=>p.x===head.x && p.y===head.y)) reset();
}

function moveBoss() {
  const bhead = {x: boss[0].x, y: boss[0].y};
  if (food.x > bhead.x) bhead.x++;
  else if (food.x < bhead.x) bhead.x--;
  else if (food.y > bhead.y) bhead.y++;
  else if (food.y < bhead.y) bhead.y--;
  boss.unshift(bhead);
  if (bhead.x === food.x && bhead.y === food.y) spawnFood();
  else boss.pop();
}

function reset() {
  if(score > highScore) highScore = score;
  score = 0;
  snake = [{x: 5, y: 5}];
  boss = [{x: 10, y: 10}];
  dx = 1; dy = 0;
}

function gameLoop() {
  move();
  moveBoss();
  draw();
  document.getElementById("scoreboard").innerText = `Poäng: ${score} | Rekord: ${highScore}`;
}

function startGame() {
  if (!running) {
    running = true;
    document.getElementById('bgm').play().catch(()=>{});
    gameInterval = setInterval(gameLoop, 200);
  }
}

// Keyboard controls
document.addEventListener('keydown', e => {
  if (e.key === "ArrowUp" && dy !== 1) {dx=0;dy=-1;}
  if (e.key === "ArrowDown" && dy !== -1) {dx=0;dy=1;}
  if (e.key === "ArrowLeft" && dx !== 1) {dx=-1;dy=0;}
  if (e.key === "ArrowRight" && dx !== -1) {dx=1;dy=0;}
  if (e.key === " " || e.key === "Enter") startGame();
});

// Mobile controls
document.querySelectorAll('.btn').forEach(btn => {
  btn.addEventListener('touchstart', e => {
    const dir = btn.getAttribute('data-dir');
    if (dir === "up" && dy !== 1) {dx=0;dy=-1;}
    if (dir === "down" && dy !== -1) {dx=0;dy=1;}
    if (dir === "left" && dx !== 1) {dx=-1;dy=0;}
    if (dir === "right" && dx !== -1) {dx=1;dy=0;}
    startGame();
  });
});

// Swipe detection
let startX, startY;
canvas.addEventListener('touchstart', e => {
  const t = e.touches[0];
  startX = t.clientX;
  startY = t.clientY;
});
canvas.addEventListener('touchend', e => {
  const t = e.changedTouches[0];
  const dxSwipe = t.clientX - startX;
  const dySwipe = t.clientY - startY;
  if (Math.abs(dxSwipe) > Math.abs(dySwipe)) {
    if (dxSwipe > 0 && dx !== -1) {dx=1;dy=0;}
    else if (dxSwipe < 0 && dx !== 1) {dx=-1;dy=0;}
  } else {
    if (dySwipe > 0 && dy !== -1) {dx=0;dy=1;}
    else if (dySwipe < 0 && dy !== 1) {dx=0;dy=-1;}
  }
  startGame();
});

// Show controls if mobile
if (/Mobi|Android/i.test(navigator.userAgent)) {
  document.getElementById('controls').style.display = 'flex';
}
</script>
</body>
</html>
