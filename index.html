<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Snake Boss v6.0 â€” Desktop</title><meta name="theme-color" content="#0b0f1d"><link rel="manifest" href="manifest.json">
<style>
:root{--bg1:#0b0f1d;--bg2:#0e1730;--glass:rgba(17,25,48,.55);--border:rgba(255,255,255,.12);
--txt:#e8f0ff;--txt-dim:#b8c7e6;--food:#ff5470;--snake:#47d16e;--boss:#7aa2f7}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;color:var(--txt);font-family:Inter,system-ui,ui-rounded,Segoe UI,Arial;
display:grid;grid-template-rows:auto 1fr auto;padding:10px;background:linear-gradient(180deg,var(--bg1),var(--bg2))}
header,footer{width:min(1200px,100%);margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:8px}
.pill{padding:8px 12px;background:var(--glass);border:1px solid var(--border);border-radius:12px;color:#a6ffe0;text-decoration:none;display:inline-flex;align-items:center;gap:6px}
.frame{width:min(1200px,100%);margin:0 auto}.stage{position:relative}
canvas{width:100%;height:auto;aspect-ratio:16/10;background:#0a0f1a;border:1px solid var(--border);border-radius:20px;image-rendering:pixelated;touch-action:none}
.hudTL,.hudTR{position:absolute;top:8px;padding:6px 10px;border-radius:12px;background:var(--glass);border:1px solid var(--border);font-weight:800}
.hudTL{left:8px}.hudTR{right:8px}
.arc{font-weight:900;letter-spacing:1px;text-shadow:0 2px 0 rgba(0,0,0,.3)}
.ftue{position:absolute;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.45);border-radius:20px}
.hook{font-weight:900;font-size:clamp(18px,5.6vw,32px);color:#8dfcc1;text-shadow:0 0 18px rgba(141,252,193,.45)}
.sub{color:#cfe1ff;font-size:13px;margin-top:4px}
.actions{display:flex;gap:8px;justify-content:center;margin-top:12px}
.cta{padding:10px 16px;border-radius:12px;background:linear-gradient(180deg,#10305a,#0b1b36);border:1px solid var(--border);color:#e6f7ff}
.mute{position:absolute;top:10px;left:10px;width:40px;height:40px;border-radius:12px;border:1px solid var(--border);background:var(--glass);color:#e8f0ff;font-size:18px;display:grid;place-items:center}
.topbar{position:absolute;top:10px;right:10px;display:flex;gap:8px}
.toggle{padding:6px 10px;border-radius:10px;border:1px solid var(--border);background:var(--glass);color:#e8f0ff;font-size:12px}
.toast{position:absolute;inset:auto 50% 12px auto;transform:translateX(-50%);background:linear-gradient(180deg,#123,#0b1326);color:#ffea9f;border:1px solid rgba(255,215,130,.35);padding:10px 14px;border-radius:12px;font-weight:700;box-shadow:0 8px 26px rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}
#bossPopup{position:absolute;left:50%;top:50%;transform:translate(-50%,-60%);background:rgba(255,209,102,.1);border:1px solid rgba(255,209,102,.5);color:#ffea9f;padding:6px 10px;border-radius:10px;font-weight:800;opacity:0;transition:opacity .15s, transform .15s}
#bossPopup.show{opacity:1;transform:translate(-50%,-64%)}
@media (max-width: 740px){
  body{padding:8px}
  .hudTL,.hudTR{font-size:12px;padding:5px 8px}
  canvas{aspect-ratio:10/16;max-height:80svh}
}
</style></head>
<body>
<header>
  <div style="font-weight:800;display:flex;align-items:center;gap:10px"><img src="snake_boss_logo.png" width="28" height="28" style="border-radius:6px;image-rendering:pixelated"> Snake Boss â€” Desktop</div>
  <div style="display:flex;gap:8px;align-items:center">
    <button id="install" class="pill" style="display:none">âž• Install</button>
    <a class="pill" href="mobile.html">ðŸ“± Mobile</a>
  </div>
</header>
<div class="frame"><div class="stage" id="stage">
  <button id="mute" class="mute" aria-pressed="false" title="Mute/Unmute">ðŸ”Š</button>
  <div class="topbar"><button id="contrast" class="toggle">Contrast</button><button id="lowfx" class="toggle">Low FX</button></div>
  <canvas id="cv"></canvas>
  <div class="hudTL"><span class="arc">SCORE</span> <span id="score">0</span></div>
  <div class="hudTR"><span class="arc">BEST</span> <span id="best">0</span></div>
  <div id="ftue" class="ftue"><div style="text-align:center">
    <div class="hook" id="hookLine">The race is on!</div>
    <div class="sub">Press Space or click canvas. Arrows/WASD to turn.</div>
    <div class="actions"><button id="start" class="cta">â–¶ Start</button></div>
  </div></div>
  <div id="toast" class="toast">NEW BEST!</div>
  <div id="bossPopup">Boss is getting stronger!</div>
</div></div>
<audio id="bgm" src="soundtrack.mp3" preload="auto" loop></audio>
<footer><div>Â© Snake Boss v6.0</div><a class="pill" href="https://www.youtube.com/@niclasvestlundYT" target="_blank">YouTube</a></footer>
<script>
if('serviceWorker' in navigator){addEventListener('load',()=>navigator.serviceWorker.register('./service-worker.js').catch(()=>{}));}
let deferredPrompt=null;const installBtn=document.getElementById('install');window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;installBtn.style.display='inline-flex';});window.addEventListener('appinstalled',()=>{installBtn.textContent='âœ… Installed';setTimeout(()=>installBtn.style.display='none',1500);});installBtn.addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();const r=await deferredPrompt.userChoice;deferredPrompt=null;installBtn.textContent=(r.outcome==='accepted')?'âœ… Installed':'âœ“ Done';setTimeout(()=>installBtn.style.display='none',1500);});
const hooks=["The race is on!","Beat me to it!","Think you're faster?","Can you stay ahead?","Outrun meâ€¦ if you can!","Your move, human!","Hungry? So am I."];let hIdx=0;setInterval(()=>{hIdx=(hIdx+1)%hooks.length;document.getElementById('hookLine').textContent=hooks[hIdx];},1800);
const settings={contrast:localStorage.getItem('sbs_contrast')==='1',lowfx:localStorage.getItem('sbs_lowfx')==='1',muted:localStorage.getItem('sbs_muted')==='1'};
function applyToggles(){document.documentElement.style.setProperty('--food',settings.contrast?'#FFD400':'#ff5470');document.documentElement.style.setProperty('--snake',settings.contrast?'#00E676':'#47d16e');document.documentElement.style.setProperty('--boss',settings.contrast?'#40C4FF':'#7aa2f7');}
applyToggles();document.getElementById('contrast').onclick=()=>{settings.contrast=!settings.contrast;localStorage.setItem('sbs_contrast',settings.contrast?'1':'0');applyToggles();};document.getElementById('lowfx').onclick=()=>{settings.lowfx=!settings.lowfx;localStorage.setItem('sbs_lowfx',settings.lowfx?'1':'0');};
let MUTED=settings.muted;const ui={cv:document.getElementById('cv'),score:document.getElementById('score'),best:document.getElementById('best'),ftue:document.getElementById('ftue'),start:document.getElementById('start'),bgm:document.getElementById('bgm'),mute:document.getElementById('mute'),toast:document.getElementById('toast'),stage:document.getElementById('stage'),bossPopup:document.getElementById('bossPopup')};
function applyMute(){try{ui.bgm.muted=MUTED}catch(e){}ui.mute.setAttribute('aria-pressed',MUTED?'true':'false');ui.mute.textContent=MUTED?'ðŸ”‡':'ðŸ”Š';}function toggleMute(){MUTED=!MUTED;localStorage.setItem('sbs_muted',MUTED?'1':'0');applyMute();if(!MUTED){try{ui.bgm.play().catch(()=>{});}catch(e){}}}ui.mute.addEventListener('click',toggleMute);applyMute();
let audioCtx;function sfx(t){if(MUTED)return;try{audioCtx=audioCtx||new(window.AudioContext||window.webkitAudioContext)();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);
 if(t==='eat'){o.type='triangle';o.frequency.value=640;g.gain.setValueAtTime(0.0001,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.22,audioCtx.currentTime+0.01);o.start();o.frequency.exponentialRampToValueAtTime(880,audioCtx.currentTime+0.09);g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.14);o.stop(audioCtx.currentTime+0.15);}
 else if(t==='hit'){o.type='sawtooth';o.frequency.value=140;g.gain.setValueAtTime(0.0001,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.28,audioCtx.currentTime+0.01);o.start();o.frequency.exponentialRampToValueAtTime(50,audioCtx.currentTime+0.22);g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.28);o.stop(audioCtx.currentTime+0.30);}
 else if(t==='gulp'){o.type='square';o.frequency.value=220;g.gain.setValueAtTime(0.0001,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.3,audioCtx.currentTime+0.01);o.start();o.frequency.exponentialRampToValueAtTime(110,audioCtx.currentTime+0.08);g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.14);o.stop(audioCtx.currentTime+0.15);}
}catch(e){}}
const ctx=ui.cv.getContext('2d',{alpha:false});let cols=30,rows=20,cell=20,padX=0,padY=0;function resize(){const r=ui.cv.getBoundingClientRect(),d=Math.min(2,devicePixelRatio||1);ui.cv.width=Math.floor(r.width*d);ui.cv.height=Math.floor(r.height*d);ctx.setTransform(d,0,0,d,0,0);cell=Math.floor(Math.min(r.width/cols,r.height/rows));padX=Math.floor((r.width-cols*cell)/2);padY=Math.floor((r.height-rows*cell)/2);}addEventListener('resize',resize);setTimeout(resize,0);
let running=false,loop=null,tickMs=120,slowMo=0,particles=[];let snake,dir='right',nextDir='right',food,score=0,best=parseInt(localStorage.getItem('sbs_best_idx_v60')||'0');let boss,bossAlt=false,shieldTicks=12,bossFlashTicks=0,shake=0;
function wrap(v,m){return (v+m)%m}function dist(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)}function onBodies(p){return snake.some(s=>s.x===p.x&&s.y===p.y)||boss.some(b=>b.x===p.x&&b.y===p.y)}function safeFood(){let c;do{c={x:(Math.random()*cols)|0,y:(Math.random()*rows)|0}}while(onBodies(c)||dist(c,snake[0])<7||dist(c,boss[0])<7);return c}
function reset(){const sy=(rows/2)|0;snake=[{x:(cols/2)|0-5,y:sy},{x:(cols/2)|0-6,y:sy},{x:(cols/2)|0-7,y:sy}];dir='right';nextDir='right';const by=Math.max(2,sy-6);boss=[{x:cols-5,y:by},{x:cols-6,y:by},{x:cols-7,y:by}];food=safeFood();score=0;ui.score.textContent=0;ui.best.textContent=best;shieldTicks=12;bossFlashTicks=0;shake=0;particles.length=0;ui.ftue.style.display='grid';}
function setDir(d){const m={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]},[dx,dy]=m[d],[cx,cy]=m[dir];if(dx===-cx&&dy===-cy)return;nextDir=d;}
function toast(){ui.toast.classList.add('show');setTimeout(()=>ui.toast.classList.remove('show'),1200);}
function popupBoss(){ui.bossPopup.classList.add('show');setTimeout(()=>ui.bossPopup.classList.remove('show'),350);}
function start(){if(running)return;running=true;ui.ftue.style.display='none';document.querySelector('.topbar').style.display='none';ui.mute.style.display='none';try{ui.bgm.volume=.28;if(!settings.muted)ui.bgm.play().catch(()=>{});}catch(e){} if(loop)clearInterval(loop);loop=setInterval(()=>{tick();draw();},tickMs);}
ui.start.onclick=start;ui.cv.addEventListener('click',()=>start());addEventListener('keydown',e=>{const k=e.key.toLowerCase();if(k===' '||k==='m')start();if(k==='m')toggleMute();if(k==='arrowup'||k==='w')setDir('up');else if(k==='arrowdown'||k==='s')setDir('down');else if(k==='arrowleft'||k==='a')setDir('left');else if(k==='arrowright'||k==='d')setDir('right');});

function bossStep(){const h=boss[0],opts=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}];opts.sort((a,b)=>(Math.abs((h.x+a.x)-food.x)+Math.abs((h.y+a.y)-food.y))-(Math.abs((h.x+b.x)-food.x)+Math.abs((h.y+b.y)-food.y)));const n={x:wrap(h.x+opts[0].x,cols),y:wrap(h.y+opts[0].y,rows)};boss.unshift(n);boss.pop();}
function gameOver(){running=false;clearInterval(loop);sfx('hit');shake=6;setTimeout(()=>{ui.ftue.style.display='grid';document.querySelector('.topbar').style.display='flex';ui.mute.style.display='grid';ui.start.textContent='â–¶ Play again';reset();draw();},360);}
function tick(){const m={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]},[dx,dy]=m[nextDir];const head={x:wrap(snake[0].x+dx,cols),y:wrap(snake[0].y+dy,rows)};
  if(shieldTicks<=0){if(snake.some((s,i)=>i&&s.x===head.x&&s.y===head.y))return gameOver();if(boss[0].x===head.x&&boss[0].y===head.y)return gameOver();} else shieldTicks--;
  snake.unshift(head);dir=nextDir;
  if(head.x===food.x&&head.y===food.y){score++;ui.score.textContent=score;sfx('eat');if(score>best){best=score;localStorage.setItem('sbs_best_idx_v60',best);ui.best.textContent=best;toast();}food=safeFood();} else snake.pop();
  const steps=(Math.random()<0.5?1:2);for(let i=0;i<steps;i++){bossStep();if(boss[0].x===food.x&&boss[0].y===food.y){sfx('gulp');popupBoss();bossFlashTicks=12;shake=6;food=safeFood();boss.push(boss[boss.length-1]);break;}}
  if(shake>0)shake--; if(bossFlashTicks>0)bossFlashTicks--;
}
function roundRect(x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath();}
function draw(){const r=ui.cv.getBoundingClientRect(),w=r.width,h=r.height;ctx.save();if(shake>0){const sx=(Math.random()*2-1)*shake, sy=(Math.random()*2-1)*shake;ctx.translate(sx,sy);}ctx.clearRect(0,0,w,h);
  const t=Date.now()*0.004,wave=Math.sin(t*0.8)*2;for(let y=0;y<rows;y++){for(let x=0;x<cols;x++){const a=((x+y)%2===0)?0.06:0.04;ctx.globalAlpha=settings.lowfx?0.05:a;ctx.fillStyle='#7aa2f7';const ox=Math.sin((x+y+t)*0.08)*wave;ctx.fillRect(padX+x*cell+ox,padY+y*cell,cell,cell);}}ctx.globalAlpha=1;
  const bob=Math.sin(t*2)*2,fx=padX+food.x*cell+4,fy=padY+food.y*cell+4+bob,pulse=(Math.sin(t*3)*0.5+0.5)*0.3+0.7;ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue('--food').trim()||'#ff5470';ctx.globalAlpha=settings.lowfx?0.9:pulse;ctx.fillRect(fx,fy,cell-8,cell-8);ctx.globalAlpha=1;
  for(let i=snake.length-1;i>=0;i--){const s=snake[i],head=i===0;const sx=padX+s.x*cell,sy=padY+s.y*cell;ctx.fillStyle=head?'#caffdd':getComputedStyle(document.documentElement).getPropertyValue('--snake').trim()||'#47d16e';roundRect(sx+1,sy+1,cell-2,cell-2,6);ctx.fill();}
  for(let i=boss.length-1;i>=0;i--){const b=boss[i],head=i===0;const bx=padX+b.x*cell,by=padY+b.y*cell;ctx.fillStyle=head?(bossFlashTicks>0?'#ffe3a1':'#d7e7ff'):(bossFlashTicks>0?'#ffd166':(getComputedStyle(document.documentElement).getPropertyValue('--boss').trim()||'#7aa2f7'));roundRect(bx+2,by+2,cell-4,cell-4,6);ctx.fill();}
  ctx.restore();
}
reset();resize();draw();
</script>
</body></html>
